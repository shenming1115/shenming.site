<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to MyWebsite</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>

  <div id="preVerifyMask">
    <div id="preVerifyBox">
      <h2>🔒 进入前安全验证</h2>
      <form action="/validate" method="POST" id="captchaForm">
        <div id="securityStatus" style="margin-bottom: 20px; text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
          <p id="preVerifyDatetime">Loading Malaysia time...</p>
          <div id="ipInfo" style="font-size: 14px; color: #ccc;"></div>
          <div id="riskLevel" style="margin: 10px 0; font-weight: bold;"></div>
        </div>
        <div class="cf-turnstile" 
             data-sitekey="0x4AAAAAABjTIyITvZEz6LO_" 
             data-theme="dark" 
             data-size="normal"
             data-callback="onTurnstileSuccess"
             data-expired-callback="onTurnstileExpired"
             data-error-callback="onTurnstileError">
        </div>
        <div style="margin-top: 10px;">
          <button type="button" id="refreshTurnstile" onclick="refreshTurnstile()" 
                  style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px; margin-right: 10px;">
            🔄 重新加载验证
          </button>
          <small style="color: #999;">如果验证卡住，请点击重新加载</small>
        </div>
        <button type="submit" id="verifyBtn" disabled style="margin-top: 15px; opacity: 0.5;">
          🛡️ 验证我是人类
        </button>
        <div id="verificationResult" style="margin-top: 15px; font-size: 14px;"></div>
      </form>
    </div>
  </div>

  <div id="mainContent" style="display:none;">
    <div class="navbar">
      <div class="navbar-links">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
        <a href="#" id="contentNav">Content</a>
      </div>
      <div class="toggle-mode" id="toggleMode">🌙</div>
    </div>

    <div class="content" id="home">
      <h1 id="mainWelcome">Welcome to MyWebsite</h1>
      <div id="mainDatetime" style="margin: 10px 0; font-size: 1.1em;"></div>
      <div id="mainIP" style="margin: 10px 0; font-size: 1.1em;"></div>
      <p>Click below to play an awesome sound!</p>
      <div class="character-wrapper">
        <img src="Assets/psycho-kev-9uYCEzNYZ2A-unsplash.jpg" alt="Minion">
        <div class="eyes-container">
          <div class="eye"><div class="pupil"></div></div>
          <div class="eye"><div class="pupil"></div></div>
        </div>
      </div>
      <audio id="audioPlayer" src="Assets/burp-1.mp3" preload="auto"></audio>
      <button id="playButton" class="button-63">Play Sound</button>
    </div>

    <!-- Content Section (hidden by default, full screen, sky/cloud flowing bg) -->
    <!-- Content Page: Only visible when clicking Content, full screen, only navbar and flowing sky background -->
    <div id="contentPage" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1000;">
      <div class="content-bg-sky"></div>
      <div class="navbar content-mode" style="position:relative; z-index:2;">
        <div class="navbar-links">
          <a href="#home">Home</a>
          <a href="#about">About</a>
          <a href="#contact">Contact</a>
          <a href="#" id="contentNav">Content</a>
        </div>
        <div class="toggle-mode" id="toggleMode">🌙</div>
      </div>
    </div>

    <div class="section" id="about">
      <h2>About</h2>
      <p>This is an awesome page designed with an elegant style.</p>
    </div>

    <div class="section" id="contact">
      <h2>Contact</h2>
      <p>Feel free to reach out through the following platforms:</p>
      <div class="social-icons">
        <a href="https://wa.me/your-phone-number" target="_blank">
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="social-icon">
        </a>
        <a href="https://www.instagram.com/your-profile/" target="_blank">
          <img src="https://upload.wikimedia.org/wikipedia/commons/9/95/Instagram_logo_2022.svg" alt="Instagram" class="social-icon">
        </a>
      </div>
    </div>
  </div>

  <script src="script.js"></script>

  <script>
    // Content section show/hide logic
    document.addEventListener('DOMContentLoaded', function() {
      const contentNavs = document.querySelectorAll('#contentNav');
      const contentPage = document.getElementById('contentPage');
      const mainContent = document.getElementById('mainContent');
      // 进入content模式
      contentNavs.forEach(contentNav => {
        contentNav.addEventListener('click', function(e) {
          e.preventDefault();
          mainContent.style.display = 'none';
          contentPage.style.display = 'block';
          // 激活content模式navbar
          document.querySelectorAll('#contentPage .navbar').forEach(nav => nav.classList.add('content-mode'));
          // 高亮Content按钮
          document.querySelectorAll('#contentPage .navbar-links a').forEach(a => {
            if(a.id === 'contentNav') a.classList.add('active');
            else a.classList.remove('active');
          });
        });
      });
      // 离开content模式
      document.querySelectorAll('.navbar-links a[href^="#"]').forEach(link => {
        if(link.id !== 'contentNav') {
          link.addEventListener('click', function() {
            contentPage.style.display = 'none';
            mainContent.style.display = 'block';
            document.querySelectorAll('#contentPage .navbar').forEach(nav => nav.classList.remove('content-mode'));
            document.querySelectorAll('#contentPage .navbar-links a').forEach(a => a.classList.remove('active'));
          });
        }
      });
    });

    // 获取马来西亚时间和IP，分别用于验证前和主界面
    async function fetchMalaysiaTimeAndIP() {
      // 获取马来西亚时间（使用 timeapi.io，支持CORS）
      try {
        const res = await fetch('https://timeapi.io/api/Time/current/zone?timeZone=Asia/Kuala_Lumpur');
        const data = await res.json();
        // 组装格式：2025-07-03 19:13:02 (MY)
        const dateStr = `${data.year}-${String(data.month).padStart(2,'0')}-${String(data.day).padStart(2,'0')} ${String(data.hour).padStart(2,'0')}:${String(data.minute).padStart(2,'0')}:${String(data.seconds).padStart(2,'0')} (MY)`;
        document.getElementById('preVerifyDatetime').textContent = dateStr;
        window._malaysiaTime = dateStr;
      } catch (e) {
        document.getElementById('preVerifyDatetime').textContent = '无法获取马来西亚时间';
        window._malaysiaTime = '';
      }
      // 获取IP
      try {
        const ipRes = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipRes.json();
        document.getElementById('ipInfo').innerHTML = 'IP: ' + ipData.ip;
        window._userIP = ipData.ip;
      } catch (e) {
        document.getElementById('ipInfo').innerHTML = 'IP: 获取失败';
        window._userIP = '';
      }
    }
    fetchMalaysiaTimeAndIP();

    // 验证成功后切换到主内容和紫色渐变背景，并显示时间/IP
    window.onTurnstileSuccess = (function(orig){
      return function(token) {
        orig(token);
        // 切换内容
        document.getElementById('preVerifyMask').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        document.body.classList.add('after-verify-bg');
        // 显示主界面时间和IP（优先用已获取的window._malaysiaTime和window._userIP）
        if (window._malaysiaTime) {
          document.getElementById('mainWelcome').textContent = window._malaysiaTime;
          document.getElementById('mainDatetime').textContent = 'Malaysia Time: ' + window._malaysiaTime;
        } else {
          document.getElementById('mainWelcome').textContent = '无法获取马来西亚时间';
        }
        if (window._userIP) {
          document.getElementById('mainIP').textContent = 'Your IP: ' + window._userIP;
        } else {
          document.getElementById('mainIP').textContent = 'IP: 获取失败';
        }
        document.getElementById('mainIP').style.display = 'block';
      }
    })(window.onTurnstileSuccess);

    // 更顺滑的水流渐变动画
    const preVerifyColors = [
      [30,60,114], [42,82,152], [106,17,203], [37,117,252], [67,206,162], [24,90,157], [247,151,30], [255,210,0], [253,29,29], [131,58,180], [252,176,69]
    ];
    let t = 0;
    function lerp(a, b, t) {
      return a + (b - a) * t;
    }
    function rgbArrToStr(arr) {
      return `rgb(${arr[0]},${arr[1]},${arr[2]})`;
    }
    function animatePreVerifyBg() {
      const mask = document.getElementById('preVerifyMask');
      if (!mask) return;
      // 计算当前渐变的两个颜色
      const idx1 = Math.floor(t) % preVerifyColors.length;
      const idx2 = (idx1 + 1) % preVerifyColors.length;
      const frac = t - Math.floor(t);
      const color1 = [
        lerp(preVerifyColors[idx1][0], preVerifyColors[idx2][0], frac),
        lerp(preVerifyColors[idx1][1], preVerifyColors[idx2][1], frac),
        lerp(preVerifyColors[idx1][2], preVerifyColors[idx2][2], frac)
      ];
      const idx3 = (idx1 + 2) % preVerifyColors.length;
      const color2 = [
        lerp(preVerifyColors[idx2][0], preVerifyColors[idx3][0], frac),
        lerp(preVerifyColors[idx2][1], preVerifyColors[idx3][1], frac),
        lerp(preVerifyColors[idx2][2], preVerifyColors[idx3][2], frac)
      ];
      mask.style.background = `linear-gradient(135deg, ${rgbArrToStr(color1)}, ${rgbArrToStr(color2)})`;
      t += 0.015; // 控制流动速度
      requestAnimationFrame(animatePreVerifyBg);
    }
    animatePreVerifyBg();
  </script>
</body>
</html>
